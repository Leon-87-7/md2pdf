# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**md2pdf** is a Python CLI tool that converts Markdown files to professionally-styled PDF documents. It's a modular package with clean separation of concerns, supporting single-file conversion, batch processing, and merge mode with 5 pre-built themes.

## Architecture

### Package Structure

The project uses a modular architecture with specialized modules:

```
md2pdf/
â”œâ”€â”€ md2pdf/                    # Main package
â”‚   â”œâ”€â”€ cli.py                # CLI interface (argparse)
â”‚   â”œâ”€â”€ core.py               # Conversion orchestrator (3 modes: single, batch, merge)
â”‚   â”œâ”€â”€ config.py             # Configuration & constants
â”‚   â”œâ”€â”€ markdown_processor.py # Markdown â†’ HTML conversion
â”‚   â”œâ”€â”€ pdf_engine.py         # PDF generation (wkhtmltopdf wrapper)
â”‚   â”œâ”€â”€ theme_manager.py      # Theme & CSS loading
â”‚   â”œâ”€â”€ file_operations.py    # File I/O operations
â”‚   â””â”€â”€ exceptions.py         # Custom exception classes
â”œâ”€â”€ themes/                    # CSS theme files (5 themes)
â”œâ”€â”€ tests/                     # Pytest test suite (116 tests, 69% coverage)
â””â”€â”€ docs/                      # Architecture and testing documentation
```

### Core Modules

**[cli.py](md2pdf/cli.py)**: Argument parsing with support for:
- Single file: `-on/--output-name` for output file
- Batch mode: `-od/--output-dir` for output directory
- Merge mode: `-m/--merge` to combine files, `-nab/--no-auto-break` to disable page breaks
- Themes: `-th/--theme` to select theme, `-thl/--theme-list` to list themes
- Preview: `-p/--preview` to auto-open PDF

**[core.py](md2pdf/core.py)**: Main orchestrator with three conversion functions:
- `convert_md_to_pdf()`: Single file conversion
- `convert_batch()`: Multiple files â†’ separate PDFs
- `convert_merge()`: Multiple files â†’ single merged PDF

**[pdf_engine.py](md2pdf/pdf_engine.py)**: wkhtmltopdf wrapper
- `find_wkhtmltopdf()`: Auto-detect installation across platforms
- Checks system PATH and common installation paths for Windows, macOS, Linux

**[theme_manager.py](md2pdf/theme_manager.py)**: Theme system
- Themes stored in `themes/` directory as CSS files
- `list_available_themes()`: Returns list of theme names
- Custom CSS takes precedence over themes

### Dependencies

- **wkhtmltopdf**: External system dependency (auto-detected at runtime)
- **Python packages**: `markdown>=3.4`, `pdfkit>=1.0.0`

## Development Commands

### Installation

```bash
# Install in editable mode with dev dependencies
pip install -e ".[dev]"

# Or install dependencies manually
pip install -r requirements.txt
```

### Running the Tool

```bash
# Single file conversion
md2pdf input.md
md2pdf input.md -on output.pdf
md2pdf input.md --theme dark -p

# Batch processing
md2pdf file1.md file2.md file3.md
md2pdf *.md --output-dir pdfs/

# Merge mode
md2pdf ch1.md ch2.md ch3.md --merge -on book.pdf
md2pdf *.md --merge --no-auto-break -on combined.pdf

# Theme management
md2pdf --theme-list
```

### Testing

```bash
# Run full test suite (116 tests)
pytest

# Run with coverage report
pytest --cov

# Run specific test file
pytest tests/test_cli.py

# Run verbose
pytest -v
```

## wkhtmltopdf Installation

The tool automatically detects wkhtmltopdf installations across platforms. If not found, it provides platform-specific installation instructions:

- **Windows**: Download from https://wkhtmltopdf.org/downloads.html and install to default location
- **macOS**: `brew install wkhtmltopdf` or download from the official site
- **Linux**:
  - Ubuntu/Debian: `sudo apt-get install wkhtmltopdf`
  - Fedora: `sudo dnf install wkhtmltopdf`

The detection checks both the system PATH and common installation locations.

## Styling System

The default CSS uses:
- Gradient backgrounds (purple/blue theme)
- Semi-transparent white boxes for content readability
- Professional typography with Segoe UI font family
- Syntax highlighting via `codehilite` markdown extension
- A4 page size with 2cm margins

Custom CSS files should include styles for all HTML elements generated by the markdown parser (headings, paragraphs, tables, code blocks, etc.).

## Git Commit Guidelines

- Never write this in a git commit:
  ```
  ðŸ¤– Generated with [Claude Code](https://claude.ai/code)              â”‚
  â”‚
  â”‚   Co-Authored-By: Claude <noreply@anthropic.com>"
  ```
